"use strict";!function(e){var t=e(document),a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/i.test(navigator.userAgent);e.expr[":"].style=function(t,a,o){var i,n,r=e(t),s=o[3].split(",");if(i=(s=e.map(s,(function(t){return e.trim(t)})))[0],n=s[1],r.css(i)==n)return!0},e.s3throttle=function(t,a,o){var i=e.s3throttle.timeouts[t];i&&clearTimeout(i),e.s3throttle.timeouts[t]=setTimeout(a,o)},e.s3escape=function(t){return e("<div>").text(t).html()},e.s3throttle.timeouts={},e.fn.s3center=function(){return this.each((function(){var t=e(this),a=t.is(":visible");a||t.show(),t.css({marginLeft:-t.outerWidth()/2,marginTop:-t.outerHeight()/2}),a||t.hide()}))},e.fn.s3deserializeArray=function(t){return this.each((function(){var a=e(this);e.each(t,(function(){var e=a.find('[name="'+this.name+'"]');e.length&&(e.is("input[type=radio]")?e.filter('[value="'+this.value+'"]').trigger("click"):e.val(this.value).trigger("change"))}))}))},e.fn.caret=function(t,a){var o;if(0!==this.length&&!this.is(":hidden"))return"number"===e.type(t)?(a="number"===e.type(a)?a:t,this.each((function(){this.setSelectionRange?this.setSelectionRange(t,a):this.createTextRange&&((o=this.createTextRange()).collapse(!0),o.moveEnd("character",a),o.moveStart("character",t),o.select())}))):(this[0].setSelectionRange?(t=this[0].selectionStart,a=this[0].selectionEnd):document.selection&&document.selection.createRange&&(o=document.selection.createRange(),t=0-o.duplicate().moveStart("character",-1e5),a=t+o.text.length),{begin:t,end:a})},e.keys={},e.KEYS={Digit:[48,57],Backspace:8,Comma:44,Point:46},e.each(e.KEYS,(function(t,a){e.keys["is"+t]=function(t){return e.isArray(a)?a[0]<=t&&t<=a[1]:a===t}})),e.fn.getVal=function(){var t=[];return this.each((function(){var a=e(this).val();(a=parseFloat(a))||(a=0),t.push(a)})),t},e.fn.keyFilter=function(t,a){return a=e.extend({type:"int",def:"",callback:e.noop},a),this.each((function(){var o=e(this);o.on("keypress",t,(function(t){var o,i,n,r,s,c=e(this);return!t.shiftKey&&!t.ctrlKey&&(0===t.which||(n=e.keys.isDigit(t.which),r=e.keys.isPoint(t.which)||e.keys.isComma(t.which),i=e.keys.isBackspace(t.which),!!(n||r||i)&&(("int"!==a.type||!r)&&(s=c.val().replace(/,/g,"."),o=c.caret(),c.val(s),c.caret(o.begin,o.end),(!r||-1===s.indexOf("."))&&void 0))))})),o.on("keyup",t,(function(){var t=e(this);a.callback(t)})),o.on("blur",t,(function(){var t=e(this);""===t.val()&&(t.val(a.def),a.callback(t))}))}))},e.fn.getHeights=function(){var t=[],a=0;return this.each((function(){var o,i=e(this);i.css("min-height",0),o=i.height(),t.push(o),o>a&&(a=o)})),{values:t,max:a}},e.fn.eachRow=function(e,t){var a,o,i,n,r,s,c=this,l=c.parent(),d=0;if(l.get(0)&&c.get(0)&&(a=l.width(),o=c.outerWidth(!0),t&&(a+=parseFloat(c.css("margin-right"))),(i=Math.floor(a/o))>1))for(s=c.length;d<s;d+=i)n=d,(r=d+i)>s&&(r=s),e(c.slice(n,r),c.eq(n),c.eq(r-1));return c},e.on=function(a,o){e.each(o,(function(e,o){t.on(e,a,o)}))},e.fn.s3tooltip=function(o){o=e.extend({data:function(){return this.alt||""},cls:"tooltip-1",slide:!0,dir:"bottom"},o);var i=e("#shop2-tooltip");i.get(0)||(i=e('<div id="shop2-tooltip"></div>'),e("body").append(i));var n,r,s=this.selector,c={$el:e(window)};e.on(s,{mouseenter:function(e){var t=o.data.call(this);t&&(c.width=c.$el.width(),c.height=c.$el.height(),i.html(t),i.addClass(o.cls),i.show(),n=i.outerWidth(!0),r=i.outerHeight(!0))},mouseleave:function(e){i.hide(),i.removeClass(o.cls)},mousemove:function(s){var l=s.pageX,d=s.pageY,p=t.scrollTop();l+n>c.width&&(l-=n),a&&l<0&&e("#shop2-tooltip").hasClass("shop2_multi_tooltip")&&(l=20),"top"==o.dir?(d-=r)<p&&(o.slide?d=p:d+=r):d+r>c.height+p&&(o.slide?d=c.height+p-r:d-=r),i.css({left:l,top:d})}})}}(jQuery),function(e,t){var a={queue:{},callbacks:{},init:function(t){e.extend(this,t),this.my=this.my||{},e((function(){var t=a.queue;e.each(t,(function(a){var o=t[a];e.isFunction(o)&&o()}))}))}};-1!=document.location.search.indexOf("debug")&&(a.debug=!0);try{if(window.sessionStorage){var o=sessionStorage.getItem("shop2_current_url"),i=location.pathname+location.search;o!=i&&sessionStorage.setItem("shop2_back_url",o),sessionStorage.setItem("shop2_current_url",i)}a.back=function(){var e;return window.sessionStorage?"null"===(e=sessionStorage.getItem("shop2_back_url"))&&(e="/"):e=document.referrer,document.location=e||"/",!1}}catch(e){a.back=function(){document.location=document.referrer}}a.on=function(t,a){var o=this;e.each(t.split(","),(function(t,i){i=e.trim(i),o.callbacks[i]||(o.callbacks[i]=e.Callbacks()),o.callbacks[i].add(a)}))},a.off=function(e,t){this.callbacks[e]&&(t?this.callbacks[e].remove(t):this.callbacks[e].empty())},a.trigger=function(e){this.callbacks[e]&&this.callbacks[e].fireWith(t,[].slice.call(arguments,1))},a.fire=function(a,o){e.isFunction(o)&&(!!(this.callbacks&&this.callbacks[a]&&this.callbacks[a].has(o))||o.apply(t,[].slice.call(arguments,2)))},a.filter={_pre_params:"",init:function(){var e=decodeURIComponent(document.location.search);e&&(e=e.slice(1)),this.str=e},escape:function(e){return e.replace(/(\[|\])/g,"\\$1")},remove:function(e,t){var a=e+"=";void 0!==t&&(a+=t);var o=new RegExp("(.*)("+this.escape(a)+"[^&]*&*)(.*)","ig");return this.str=this.str.replace(o,"$1$3").replace(/&$/,""),this},add:function(e,t){return this.remove(e,t),this.str+=""!==this.str?"&":"",this.str+=e+"="+t,this},has:function(e,t){var a=e+"=";return void 0!==t&&(a+=t),this.str.indexOf(a)>-1},get:function(e){var t=new RegExp(this.escape(e)+"=([^&]*)"),a=this.str.match(t);return!(!a||2!=a.length)&&a[1]},toggle:function(e,t){if("s[amount][min]"==e){if("0"===this.get("s[amount][max]"))return this.remove("s[amount][max]"),this.add("s[amount][min]",0),this;if("0"===this.get("s[amount][min]"))return this.remove("s[amount][min]"),this.add("s[amount][max]",0),this}else if("s[amount][max]"==e){if("1"===this.get("s[amount][min]"))return this.remove("s[amount][min]"),this.add("s[amount][min]",0),this;if("0"===this.get("s[amount][min]"))return this.remove("s[amount][min]"),this.add("s[amount][min]",1),this}return this.has(e,t)?this.remove(e,t):this.add(e,t),this},sort:function(e){var t=new RegExp(this.escape("s[sort_by]")+"=([^&]*)"),a=this.str.match(t),o=e+" desc",i=e+" asc";return-1!==(a=a&&a.length>1?a[1]:"").indexOf(o)?a=a.replace(o,i):-1!==a.indexOf(i)?a=a.replace(i,o):""!==a?a+=","+o:a=o,this.remove("s[sort_by]"),this.add("s[sort_by]",a),this},go:function(){var e="";return this.str&&(e+="?"==this.str.charAt(0)?"":"?",e+=this.str),document.location=document.location.pathname.replace(/\/p\/\d*/g,"")+e+document.location.hash,!1},count:function(t){var o="/my/s3/api/shop2/?cmd=getSearchMatches&hash="+a.apiHash.getSearchMatches+"&ver_id="+a.verId+"&"+this.str+this._pre_params;a.trigger("beforeGetSearchMatches"),e.get(o,(function(o,i){"success"==i&&"string"===e.type(o)&&(o=e.parseJSON(o)),a.facets.enabled&&a.facets.aggregation(o),a.fire("afterGetSearchMatches",t,o,i),a.trigger("afterGetSearchMatches",o,i)}))}},a.search={getParams:function(t,o){var i;a.trigger("beforeGetFolderCustomFields"),t>0&&(i="/my/s3/api/shop2/?cmd=getFolderCustomFields&hash="+a.apiHash.getFolderCustomFields+"&ver_id="+a.verId+"&folder_id="+t+"&"+decodeURIComponent(document.location.search).replace(/[^&]*=(&|$)/g,""),e.getJSON(i,(function(e,t){a.fire("afterGetFolderCustomFields",o,e,t),a.trigger("afterGetFolderCustomFields",e,t)})))}},a.facets={enabled:!1,aggs:null,_data:{},emptyClass:"empty-val",mask:'[data-name^="s[field]"][data-value="key"],[name="s[parentField][parentKey]"] [value="key"],[name="s[field]"] [value="key"],[data-name="s[field][index]"],[data-name="s[field][key]"],[name="s[field][key]"]',filter:{wrapper:".shop2-filter, #shop2-color-ext-list",items:"[data-name], [name], [name] [value]"},search:{wrapper:".shop2-block.search-form form, #shop2-color-ext-select",items:"[data-name], [name], [name] [value]"},ignoreClear:function(e){return this._data.attrName=e.attr("name")?e.attr("name"):e.parent().attr("name"),this._data.isSelect="select"===e.prop("tagName").toLowerCase(),this._data.val="option"===e.prop("tagName").toLowerCase()&&""===e.val(),/s\[(folder_id|products_per_page)\]/i.test(this._data.attrName)||this._data.isSelect||this._data.val},set:function(t){var o=a.facets[t];if(o){var i=e(o.wrapper),n=i.find(o.items);this._data.$wrapper=i,this.clearItems(n),this.insertData(this.aggs);var r="afterFacets"+t.charAt(0).toUpperCase()+t.slice(1);a.trigger(r,this.aggs)}},searchSetup:function(){if(this.search){var t=e(this.search.wrapper);if(t.length){var o=t.find(this.search.items),i=this,n="/my/s3/api/shop2/?cmd=getSearchMatches&hash="+a.apiHash.getSearchMatches+"&ver_id="+a.verId+"&",r=n+t.serialize();this.getDataSearch(r),o.on("change",(function(e){"s[products_per_page]"!=e.target.name&&(r=n+t.serialize(),i.getDataSearch(r))}))}}},getDataSearch:function(t){e.get(t,(function(t,o){"success"==o&&("string"===e.type(t)&&(t=e.parseJSON(t)),a.facets.aggregation(t),a.facets.set("search"))}))},clearItems:function(t){var a,o=this.emptyClass,i=this;t.each((function(t,n){if(a=e(n),i.ignoreClear(a))return!0;switch(a.prop("tagName").toLowerCase()){case"select":break;case"input":a.attr("placeholder","");break;case"option":a.attr("value")&&a.attr("disabled","disabled")}a.attr("data-param-val","0"),a.addClass(o)}))},aggregation:function(e){return"object"==typeof e&&e.data.aggs&&(this.aggs=this.dataSetup(e.data.aggs)),this.aggs},dataSetup:function(t){var a,o,i=t.cf;for(a in i)o=i[a],e.isArray(o)&&!o.length&&delete i[a];return t},insertData:function(t,a,o){e.each(t,e.proxy((function(e,t){if("object"==typeof t)this.insertData(t,e,a);else{if(this._data.$item=this.getItem(a,e,o),!this._data.$item.length||!t&&0!=t)return!0;switch(this._data.$item.prop("tagName").toLowerCase()){case"input":this._data.$item.attr("placeholder",t);break;case"option":this._data.$item.removeAttr("disabled")}this._data.$item.attr("data-param-val",t),this._data.$item.removeClass(this.emptyClass)}}),this))},getItem:function(e,t,a){return this._data.selector=a&&"cf"!==a?this.mask.replace(/parentField/g,a).replace(/parentKey/g,e).replace(/key/g,t):this.mask.replace(/field/g,e).replace(/key/g,t),this._data.$wrapper.find(this._data.selector)},setMask:function(e){this.mask=e},setEmptyClass:function(e){this.emptyClass=e},setContainers:function(e,t){this[e]=t}},a.cart={add:function(t,o,i){a.trigger("beforeCartAddItem"),e.post("/my/s3/api/shop2/?cmd=cartAddItem",{hash:a.apiHash.cartAddItem,ver_id:a.verId,kind_id:t,amount:o},(function(e,t){a.fire("afterCartAddItem",i,e,t),a.trigger("afterCartAddItem",e,t)}),"json")},addMultiple:function(t,o){a.trigger("beforeCartAddMultipleItems"),t=e.extend({hash:a.apiHash.cartAddItem,ver_id:a.verId},t),e.post("/my/s3/api/shop2/?cmd=cartAddItem",t,(function(e,t){a.fire("afterCartAddMultipleItems",o,e,t),a.trigger("afterCartAddMultipleItems",e,t)}),"json")},remove:function(t,a){return e.loadingScreen("show"),e.ajax({url:a,type:"GET",data:"delete="+t+"&_="+Date.now(),success:function(a){e.loadingScreen("hide"),e(a).find(".cart-product").length?(e('.cart-product[data-id="'+t+'"]').remove(),e(".cart-update__btn").removeClass("active"),e(".cart-total.recalc_active").html(e(a).find(".cart-total.recalc_active").html())):e(".site-main__body.block_padding").html(e(a).find(".site-main__body.block_padding").html())}}),!1},clear:function(){a.trigger("beforeCartClear"),e.get(a.uri+"?mode=cart&action=cleanup",(function(e,t){a.trigger("afterCartClear",e,t)}))},update:function(t,a){var o=t.serialize();return e.loadingScreen("show"),e.ajax({url:t.attr("action"),type:"POST",data:o+"&recount=1",success:function(t){e.loadingScreen("hide"),e(".cart-update__btn").removeClass("active"),e(".cart-total.recalc_active").html(e(t).find(".cart-total.recalc_active").html())}}),!1},addCoupon:function(t,o){return a.trigger("beforeCartAddCoupon"),e.getJSON("/my/s3/api/shop2/?cmd=cartAddCoupon",{hash:a.apiHash.coupon_add,ver_id:a.verId,coupon:t},(function(e,t){a.fire("afterCartAddCoupon",o,e,t),a.trigger("afterCartAddCoupon",e,t)})),!1},removeCoupon:function(t,o){a.trigger("beforeCartRemoveCoupon"),e.getJSON("/my/s3/api/shop2/?cmd=cartRemoveCoupon",{hash:a.apiHash.coupon_del,ver_id:a.verId,coupon:t},(function(e,t){a.fire("afterCartRemoveCoupon",o,e,t),a.trigger("afterCartRemoveCoupon",e,t)}))}},a.delivery={deligate:!1,ymapsMap:null,ymapsData:[],ymapsIconsData:{default:"/g/shop2v2/default/images/map-pin-grey.svg",spsr:"/g/shop2v2/default/images/map-pin-red.svg",dellin:"/g/shop2v2/default/images/map-pin-purple.svg",edostavka:"/g/shop2v2/default/images/map-pin-green.svg",pickpoint:"/g/shop2v2/default/images/map-pin-grey.svg",boxberry:"/g/shop2v2/default/images/map-pin-boxberry.svg",delica:"/g/shop2v2/default/images/map-pin-grey.svg",selected:"/g/shop2v2/default/images/map-pin-blue.svg"},calc:function(t,o,i){a.trigger("beforeDeliveryCalc"),e.getJSON("/my/s3/api/shop2/?cmd=deliveryCalc",{hash:a.apiHash.calc,ver_id:a.verId,attach_id:t,params:o},(function(e,t){a.fire("afterDeliveryCalc",i,e,t),a.trigger("afterDeliveryCalc",e,t)}))},YmapsInit:function(t){var o=Object.keys(a.delivery.ymapsData).length,i=e(".baloon-content-localize"),n=(i.data("point-text"),i.data("term-text")),r=(i.data("price-text"),i.data("address-text"),i.data("phone-text")),s=i.data("worktime-text"),c=i.data("url-text"),l=i.data("more-text"),d=i.data("choose-text");if(!o)return e(".shop2-delivery--item__tab.points").addClass("disabled"),!1;var p=e.parseJSON(e("#dadata").val()),u=[p.geo_lat,p.geo_lon],h={id:t,center:u,zoom:11};ymaps.ready((function(){a.delivery.ymapsMap=new ymaps.Map(h.id,{center:h.center,zoom:h.zoom,controls:["zoomControl"]});var o=ymaps.templateLayoutFactory.createClass('<div class="delivery-baloon-content"><h3>$[properties.address]</h3><div class="buttons"><button type="button" class="shop2-btn" id="balloon-select">'+d+'</button>[if properties.site]<a target="_blank" class="shop2-btn" href="$[properties.site]">'+l+'</a>[endif]</div><div class="note-block">[if properties.term] <p><span>'+n+':</span><strong class="term">$[properties.term]</strong></p>[endif] <p>$[properties.cost]</p> </div>[if properties.phone]<div class="phone"><span>'+r+':</span>$[properties.phone]</div>[endif][if properties.worktime]<div class="worktime"><span>'+s+':</span>$[properties.worktime]</div>[endif][if properties.desc]<div class="desc"><span>'+c+':</span>$[properties.desc]</div>[endif]<form data-attach_id="$[properties.attach_id]"><input type="hidden" name="delivery_type" value="$[properties.delivery_type]"><input class="point-address" type="hidden" name="$[properties.attach_id][0]" value="$[properties.address]"><input type="hidden" name="$[properties.attach_id][deligate][tarif]" class="tariff" value="$[properties.tariff_hash]"><input type="hidden" name="$[properties.attach_id][deligate][terminal]" value="$[properties.id]"></form></div>',{build:function(){o.superclass.build.call(this),e("#balloon-select").bind("click",this.onCounterClick)},clear:function(){e("#balloon-select").unbind("click",this.onCounterClick),o.superclass.clear.call(this)},onCounterClick:function(t){t.preventDefault();var o=e(this).parents(".delivery-baloon-content:first"),i=o.find("form"),n=o.find("h3").text(),r=o.find("label.cost input:checked"),s=r.parent().data("cost"),c=o.find(".term").text(),l=i.data("attach_id"),d=e("#shop2-order-delivery"),p=(d.find(".option-label"),d.find(".option-type"),d.find(".option-details"),d.find(".shop2-delivery--item__tab.points"),e(a.delivery.ymapsMap.container._parentElement).next()),u=i.find("input.point-address").val(),h=e(a.delivery.ymapsMap.container._parentElement).parents(".option-details:first");if(e("#delivery_id_deligate").val(l),i.find("input.tariff").val(r.val()),p.find(".fields").html(i.html()),p.find(".point-name").html(n),p.find(".point-cost").html(s),p.find(".point-term").html(c),p.find(".point-address").html(u),h.addClass("selected"),e("html, body").scrollTop(h.parent().offset().top-60),6==a.shop2_cart_order_payments){let t={};t.property_attach={delivery_type:i.find('[name="delivery_type"]').val(),deligate:{tarif:r.val(),terminal:i.find('[name="900[deligate][terminal]"]').val()}},t.property_attach[0]=u,t.value=l,e(this).closest(".option-details").find(".g-form-field__value .g-form-control-value").each((function(e,a){let o=e+1;t.property_attach[`${o}`]=a.value})),a.queue.orderGetPayments(!0,t)}a.delivery.ymapsMap.balloon.close();{let t=a.my.on_shop2_btn?".shop2-btn":".g-button";e(`.form-item ${t}.shop2-disabled`).length&&(e(`.form-item ${t}.shop2-disabled`).removeClass("shop2-disabled"),e(".order_design_five").addClass("hide"))}}}),i=new ymaps.GeoObjectCollection;e.each(a.delivery.ymapsData[t],(function(e,n){var r=a.delivery.ymapsIconsData[t]||a.delivery.ymapsIconsData.default;if(n.service_code==t){var s=new ymaps.Placemark(n.coords,n,{balloonContentLayout:o,iconLayout:"default#image",iconImageHref:r,iconImageSize:[26,36],iconImageOffset:[-13,-36],balloonMaxWidth:530,balloonPanelMaxMapArea:"Infinity",balloonMinHeight:330,balloonshadow:!1});s.events.add("click",(function(e){for(var t=0;t<i.getLength();t++)i.get(t).options.set("iconImageHref",a.delivery.ymapsIconsData.default);e.get("target").options.set("iconImageHref",a.delivery.ymapsIconsData.selected)})),i.add(s)}})),a.delivery.ymapsMap.geoObjects.add(i),a.delivery.ymapsMap.container.fitToViewport(),a.delivery.ymapsMap.behaviors.disable("multiTouch")}))},changeDeliveryPoint:function(t,o){var i=e(t).parents(".option-details:first");a.delivery.ymapsMap&&(a.delivery.ymapsMap.destroy(),a.delivery.ymapsMap=null),i.find(".map-select select option:first").prop("selected",!0),i.find(".map-select select").trigger("refresh"),i.find(".deligate_points_fields .fields").empty(),i.removeClass("selected"),e("html, body").scrollTop(i.parent().offset().top-60),a.delivery.YmapsInit(o);{let t=a.my.on_shop2_btn?".shop2-btn":".g-button";e(`.form-item ${t}`).length&&(e(`.form-item ${t}`).addClass("shop2-disabled"),e(".order_design_five").removeClass("hide"))}return!1},selectSuggestion:function(t,a){var o=t;e.ajax({url:"/my/s3/xapi/public/?method=deligate/suggestAddress",type:"POST",dataType:"json",data:JSON.stringify({query:o,count:1}),success:function(t){t.result.suggestions&&(t.result.suggestions[0].data.source=o),a||(e("#dadata").val(JSON.stringify(t.result.suggestions[0].data)),e("#address").val(t.result.suggestions[0].value)),e("#shop2-deligate-calc").trigger("click")}})}},a.compare={add:function(e,t){this.action("add",e,t)},remove:function(e,t){this.action("del",e,t)},clear:function(e){this.action("clear",null,e)},action:function(t,o,i){var n=e.camelCase("Compare-"+t);a.trigger("before"+n),e.post("/my/s3/api/shop2/?cmd=compare",{hash:a.apiHash.compare,ver_id:a.verId,kind_id:o,action:t},(function(e,t){a.fire("after"+n,i,e,t),a.trigger("after"+n,e,t)}))}},a.product={getProductListItem:function(t,o,i,n){var r="/my/s3/api/shop2/?cmd=getProductListItem&hash="+a.apiHash.getProductListItem+"&ver_id="+a.verId;a.trigger("beforeGetProductListItem"),e.post(r,{product_id:t,kind_id:o,params:n},(function(e,t){a.fire("afterGetProductListItem",i,e,t),a.trigger("afterGetProductListItem",e,t)}))},checkMetaItemValue:function(e,t,a){var o=e[t];if("undefined"==o||null==o)return!1;if(o==a)return!0;if(o instanceof Object)for(var i in o)if(o[i]==a)return!0;return!1},getMetaItemValue:function(t,a){var o=t[a];if("undefined"===e.type(o))return!1;if("object"===e.type(o)){if("undefined"!==e.type(o.v))return o.v;if("undefined"!==e.type(o.image_id))return o.image_id}return o},findKindId:function(t,o,i,n,r,s){var c,l,d,p,u,h=0,m=e.extend(!0,{},a.productRefs[t]);if(s&&e.each(m,(function(e){s[e]||delete m[e]})),1==o.length)return o[0];for("object"!==e.type(r)&&(r=e.parseJSON(r)),c=0,l=o.length;c<l;c+=1)d=Number(o[c]),u=0,e.each(m,(function(t,o){e.each(o,(function(e){if(t==i)e==n&&(u+=1);else{if(-1===String(m[t][e]).indexOf(d))return;u+=1,r&&a.product.checkMetaItemValue(r,t,e)&&(u+=1)}}))})),u>h&&(p=d,h=u);return p},getNodeData:function(t,a,o){var i=!1;return"SELECT"==t.tagName?i=e(t.options[t.selectedIndex]).data(a):1==t.nodeType&&(i=e(t).data(a)),o&&(i=this.decodeFieldData(i)),i},decodeFieldData:function(t){return"string"!==e.type(t)?[t]:(t=t.split(","),e.map(t,(function(t){return e.trim(t)})))},hasKindId:function(e,t){var a,o;if(e)for(a=0,o=t.length;a<o;a+=1)if(-1!==e.indexOf(t[a]))return!0;return!1},deleteUploadProduct:function(t,a){var o=new FormData;o.append("kind_id",a),o.append("code",t),e.ajax({url:"/my/s3/xapi/public/?method=shop2/removeUploadFileProduct",type:"post",dataType:"json",processData:!1,contentType:!1,data:o,success:function(e){(e=void 0!==e.result?e.result:e).success?document.location.reload(!0):alert(e.error)}})},uploadProduct:function(t,a,o,i){var n=new FormData,r=e("#_upload_"+t+a).parent(),s=e("#_upload_"+t+a).get(0).files,c='<span class="delete-upload-file shop2-btn" onclick="shop2.product.deleteUploadProduct(\''+t+"',"+a+')">удалить</span>';if(0==s.length)return alert(_s3Lang.JS_FILES_NOT_SELECTED),!1;e.each(s,(function(e,a){n.append(t,a)})),n.append("kind_id",a),n.append("code",t),o&&(n.append("image",!0),i&&n.append("params",JSON.stringify(i))),e.ajax({url:"/my/s3/xapi/public/?method=shop2/uploadFileProduct",type:"post",dataType:"json",processData:!1,contentType:!1,data:n,success:function(e){(e=void 0!==e.result?e.result:e).success?o?r.empty().html('<img src="'+e.data+'">'+c):r.empty().html('<a href="/u/'+e.data+'">'+e.data+"</a>"+c):alert(e.error)}})},uploadInCart:function(t,a,o,i,n){var r=new FormData,s=e("#_upload_in_cart_"+t+"_"+a+"_"+o).parent(),c=e("#_upload_in_cart_"+t+"_"+a+"_"+o).get(0).files,l='<span class="delete-upload-file shop2-btn" onclick="shop2.product.deleteUploadInCart('+t+", "+a+", '"+o+"')\">удалить</span>";if(0==c.length)return alert(_s3Lang.JS_FILES_NOT_SELECTED),!1;e.each(c,(function(e,t){r.append(o,t)})),r.append("kind_id",t),r.append("code",o),r.append("pos",a),i&&(r.append("image",!0),n&&r.append("params",JSON.stringify(n))),e.ajax({url:"/my/s3/xapi/public/?method=shop2/uploadFileProductInCart",type:"post",dataType:"json",processData:!1,contentType:!1,data:r,success:function(e){(e=void 0!==e.result?e.result:e).success?i?s.empty().html('<img src="'+e.data+'">'+l):s.empty().html('<a href="/u/'+e.data+'">'+e.data+"</a>"+l):alert(e.error)}})},deleteUploadInCart:function(t,a,o){var i=new FormData;i.append("kind_id",t),i.append("code",o),i.append("pos",a),e.ajax({url:"/my/s3/xapi/public/?method=shop2/removeUploadFileProductInCart",type:"post",dataType:"json",processData:!1,contentType:!1,data:i,success:function(e){(e=void 0!==e.result?e.result:e).success?document.location.reload(!0):alert(e.error)}})},productDatePicker:function(){e(".shop2-date_interval , .shop2-date").each((function(t,a){e(this).datepicker({minDate:0,changeMonth:!1,numberOfMonths:1,showOn:"button",buttonImage:"/g/shop2v2/default/images/shop2_calendar.svg",buttonImageOnly:!1,buttonText:"Select date"})}))}},a.options={amountDefaultValue:1,amountDefaultInc:1,amountType:"float",msgTime:3e3,printCSS:"/g/shop2v2/default/css/print.less.css"},a.user={activate:function(t,a){var o=e(a);o.attr("disabled",!0),e.post("/my/s3/xapi/public/?method=user/reactivation",{user_id:t},(function(){var t=o.parent(),a=e("<div>").addClass("shop2-info").html(window._s3Lang.ACTIVATION_MAIL_SENT);o.hide(),t.append(a)}))}},a.orderCancelling={alert:function(){var t=e(".order-cancelling"),o=t.data("href"),i='<div class="order-cancel-title">'+t.data("cancellingTitle")+'</div><div class="order-cancel-buttons"><a class="shop2-btn" href="'+o+'">'+t.data("cancellingButtonTitle")+'</a><a class="shop2-alert-close" onclick="shop2.alert.hide(); return false;" href="#">'+t.data("cancellingClose")+"</a></div>";a.alert(i,"","shop2-alert--warning order-cancel")}},e(document).on("click",".order-cancelling",(function(e){e.preventDefault(),a.orderCancelling.alert()})),a.orderRepeat={alert:function(e){var t=e.filter(".order-repeat"),o=t.data("href"),i='<div class="order-repeat-title">'+t.data("repeatTitle")+'?</div><div class="order-repeat-buttons"><a class="shop2-btn" href="'+o+'">'+t.data("repeatButtonTitle")+'</a><a class="shop2-alert-close" onclick="shop2.alert.hide(); return false;" href="#">'+t.data("repeatClose")+"</a></div>";a.alert(i,"Закрыть","shop2-alert--warning order-cancel")}},e(document).on("click",".order-repeat",(function(t){t.preventDefault(),a.orderRepeat.alert(e(this))})),a.paymentChange={alert:function(t){var o=t.filter(".order-payment-change"),i=o.data("href"),n=o.data("title"),r=o.data("button-title"),s=o.data("close");e.ajax({url:i,type:"POST",dataType:"json",data:{},success:function(e){var t='<div class="payment-change-title">'+n+'</div><div class="error"></div>'+e.data+'<div class="payment-change-buttons"><a class="shop2-btn" onclick="shop2.paymentChange.save(\''+i.replace("act=list","act=save")+'\');" href="#">'+r+'</a><a class="shop2-alert-close" onclick="shop2.alert.hide(); return false;" href="#">'+s+"</a></div>";a.alert(t,s,"shop2-alert--warning order-cancel")}})},save:function(t){var a=e("#shop2-alert-body .shop2-payment-options").serialize();return e.ajax({url:t+"&"+a,type:"POST",dataType:"json",data:{},success:function(t){"OK"===t.data?document.location.reload():e("#shop2-alert-body .error").html(t.data)}}),!1}},e(document).on("click",".order-payment-change",(function(t){t.preventDefault(),a.paymentChange.alert(e(this))})),e(document).on("click.getPromoLink",".get-promo-link",(function(t){t.preventDefault();var o=e(this).data("ver-id"),i=e(this).data("cmd"),n=a.apiHash.getPromoProducts,r=e(this).data("is-main"),s=e(this).data("kind-id"),c=e(this).data("discount-id");e.ajax({url:"/my/s3/api/shop2/?ver_id="+o+"&cmd="+i+"&hash="+n+"&kind_id="+s+"&discount_id="+c+"&is_main="+r,type:"POST",dataType:"json",data:{},success:function(e){a.alert(e.data,"Закрыть","promo-products-list")}})})),e(document).on("click.promoPagelist",".promo-products-list li",(function(t){t.preventDefault();var o=e(this).find("a").attr("href");e.ajax({url:o,type:"POST",dataType:"json",data:{},success:function(e){a.alert(e.data,"Закрыть","promo-products-list")}})})),a.msg=function(t,o){var i="#shop2-msg",n=e(i),r=o.offset(),s=o.outerWidth(!0),c=o.outerHeight(!0);n.get(0)||(n=e('<div id="shop2-msg">'),e(document.body).append(n),n=e(i)),n.html(t).show();var l=n.outerWidth(),d=r.left+s,p=r.top+c;d+l>e(window).width()&&(d=r.left-l),n.css({left:d,top:p}),e.s3throttle("msg",(function(){n.hide()}),a.options.msgTime)},a.queue={cookiesDisabled:function(){navigator&&0==navigator.cookieEnabled&&e(".shop2-cookies-disabled").html("<p>Внимание! Для корректной работы у Вас в браузере должна быть включена поддержка cookie. В случае если по каким-либо техническим причинам передача и хранение cookie у Вас не поддерживается оформление заказа невозможно.</p>").removeClass("hide")},cartState:function(){try{window.sessionStorage}catch(e){return}window.chrome&&sessionStorage&&a.my.save_cart_state&&(readCookie("s3s2_cart")||(sessionStorage.removeItem("cart-reload"),sessionStorage.removeItem("cart-state")),1==sessionStorage.getItem("cart-reload")&&(sessionStorage.removeItem("cart-reload"),sessionStorage.setItem("cart-state",e("<div>").append(e("#shop2-cart-preview").clone()).html())),a.on("afterCartAddItem",(function(e,t){var a=e.data;"success"!=t&&(a=""),sessionStorage.setItem("cart-state",a)})),a.on("afterCartRemoveItem, afterCartUpdate",(function(){sessionStorage.setItem("cart-reload",1)})),e(window).on("pageshow",(function(){var t;(t=sessionStorage.getItem("cart-state"))&&e("#shop2-cart-preview").replaceWith(t)})))},keys:function(){e(document).keyFilter("input.shop2-input-int"),e(document).keyFilter("input.shop2-input-float",{type:"float"})},heights:function(){e(".product-list-thumbs").each((function(){e(this).find(".product-item-thumb").eachRow((function(t){var a,o,i=t.find(".product-name");i.css("min-height",0),o=i.getHeights(),i.css("min-height",o.max);var n=t.find(".product-amount");n.length?(n.css("margin-top",0),a=t.getHeights(),t.each((function(t){e(this).find(".product-amount").css("margin-top",a.max-a.values[t])}))):(t.each((function(){var t=e(this),a=t.find(".shop2-product-actions");a.length||(a=t.find(".product-bot"));var o=a.data("padding-top");"undefined"===e.type(o)&&(o=parseInt(t.css("padding-top")),a.data("padding-top",o)),a.css("padding-top",o)})),a=t.getHeights(),t.each((function(t){var o=e(this),i=o.find(".shop2-product-actions");i.length||(i=o.find(".product-bot"));var n=i.data("padding-top");i.css("padding-top",a.max-a.values[t]+n)})))}))}))},resize:function(){e(window).resize((function(){a.queue.heights()}))},product:function(){a.product._reload=function(t){var o,i,n,r=e(t),s=a.product.getNodeData(t,"kinds",!0),c=a.product.getNodeData(t,"name"),l=a.product.getNodeData(t,"value"),d=r.closest("form"),p=d.get(0),u={},h={},m=!1;s&&"undefined"!==e.type(c)&&"undefined"!==e.type(l)&&p&&(o=d.find("input[name=meta]").val(),n=d.find("input[name=product_id]").val(),d.find("[name=submit]").prop("disabled",!0),d.find("select.shop2-cf>option, li.shop2-cf, li.shop2-color-ext-selected, ul.shop2-color-ext-list>li").each((function(){var t=e(this).data("name");t&&(u[t]=!0)})),(i=a.product.findKindId(n,s,c,l,o,u))||(i=d.find("[name=kind_id]").val(),m=!0),d.find(".js-calc-custom-fields.additional-cart-params").each((function(){var t=e(this).attr("name");h[t]=e(this).find("option:selected").data("item-id")})),d.find(".js-calc-custom-fields.shop2-color-ext-selected").each((function(){var t=e(this).data("name");h[t]=e(this).data("item-id")})),m?a.product.getProductListItem(n,i,(function(t,o){if("success"===o){var i=e.trim(t.data.body),n=e(".product-price",i).html(),r=e(".shop2-product-actions",i).html();d.find(".product-price").html(n),d.find(".shop2-product-actions").html(r),a.trigger("afterProductReloaded"),a.queue.heights()}}),h):"product"===a.mode?a.uri?document.location=a.uri+"/product/"+i:document.location=document.location.href.replace(/\/product\/.+/,"/product/"+i):a.product.getProductListItem(n,i,(function(t,o){var i,n;"success"===o&&(a.trigger("afterProductReloaded"),(i=r.closest(".shop2-product-item")).hide(),n=e.trim(t.data.body),e(n).insertBefore(i),i.remove(),a.queue.heights())}),h))},e.on("select.shop2-cf",{change:function(){a.product._reload(this)}}),e.on("li.shop2-cf:not(.active-color, .active-texture)",{click:function(){a.product._reload(this)}}),e.on("span.shop2-path-show-folders",{click:function(t){t.preventDefault(),e(this).next().show(),e(this).hide()}})},addToCart:function(){e(document).on("click",".shop2-product-btn:not(.preorder-btn-js)",(function(t){var o,i,n=e(this),r=n.closest("form"),s=r.get(0),c=r.find(".additional-cart-params"),l=c.length,d=s.amount.value,p=s.kind_id.value;if(t.preventDefault(),l)for(d={amount:d},o=0;o<l;o+=1)(i=c[o]).value&&(d[i.name]=i.value);a.cart.add(p,d,(function(t){if(e("#shop2-cart-preview").replaceWith(t.data),t.errstr)a.msg(t.errstr,n);else{var o=window._s3Lang.JS_SHOP2_ADD_CART_WITH_LINK;a.msg(o.replace("%s",a.uri+"/cart"),n)}t.panel&&e("#shop2-panel").replaceWith(t.panel)}))}))},amount:function(){var t=e(document);function o(e,t,o,i){return e=(e+=o>0?o*i:a.options.amountDefaultInc*i).toFixed(2)-0}t.on("click",".amount-minus",(function(){var t=e(this).siblings("input:text"),i=t.getVal(),n=parseFloat(t.data("min")),r=parseFloat(t.data("multiplicity"));i&&(i=i[0]),n&&i<=n||(i=o(i,n,r,-1),n>0?i<=n&&(i=n):i<=a.options.amountDefaultValue&&(i=a.options.amountDefaultValue),t.val(i),t.trigger("change"))})),t.on("click",".amount-plus",(function(){var t=e(this).siblings("input:text"),a=t.getVal(),i=parseFloat(t.data("min")),n=parseFloat(t.data("multiplicity"));a&&(a=a[0]),a=o(a,i,n,1),t.val(a),t.trigger("change")})),t.on("change",".shop2-product-amount input:text",(function(){!function(e){var t,o=e.data("kind"),i=e.data("max"),n=Number(e.val()),r=0,s=parseFloat(e.data("min")),c=parseFloat(e.data("multiplicity"));if(o&&i>0&&(r=Number(e.val()))>i&&(t=i-r+n,e.val(t),t=t.toFixed(2)-0,a.msg(_s3Lang.JS_AVAILABLE_ONLY+" "+t,e)),s||c){if(c){var l=(n-s)%c;l<c/2?n-=l:n+=c-l,1===s&&c>1&&n--,n=n.toFixed(2)-0,e.val(n)}s>0?s&&n<=s&&e.val(s):n<=a.options.amountDefaultValue&&e.val(amountDefaultValue)}}(e(this))})),t.keyFilter(".shop2-product-amount input:text",{type:a.options.amountType})},kindAvailable:function(){var t={};e(document).on("click",".preorder-btn-js",(function(o){if(o.preventDefault(),t.data={},t.jQbtn=e(this),t.data.kind_id=t.jQbtn.data("product-kind_id"),t.data.email=t.jQbtn.data("user-email")||0,t.data.email)var i=`\n                <div class="preorder-field preorder-email">\n                    <span class="preorder-email_text">\n                        ${a.my.preorder_email_text||"Данный email указан при регистрации."}\n                    </span>\n                    <div class="preorder-email-input">\n                        <div class="preorder-field-title">E-mail: <span class="preorder-mark">*</span></div>\n                        <div class="preorder-field-value">\n                            <input type="text" name="email" required value="${t.data.email}">\n                        </div>\n                    </div>\n                </div>\n                `;else i='\n                <div class="preorder-field preorder-email">\n                    <div class="preorder-email-input">\n                        <div class="preorder-field-title">E-mail: <span class="preorder-mark">*</span></div>\n                        <div class="preorder-field-value">\n                            <input type="text" name="email" required value="">\n                        </div>\n                    </div>\n                </div>\n                ';var n=`\n                        <div class="preorder-form-wrap preorder-popup">\n                            <form class="preorder-popup-body" action="/my/s3/xapi/public/?method=shop2/addKindEmailNotification" method="get">\n                                <h2 class="preorder-popup-title">\n                                    ${a.my.preorder_form_title||"Узнать о поступлении"}\n                                </h2>\n                                <div class="preorder-popup-text preorder-field type-html">\n                                    ${a.my.preorder_form_text||"Оставьте почту и мы напишем вам, когда товар появится в наличии."}\n                                </div>\n                                ${i}\n                                <input type="hidden" name="kind_id" value="${t.data.kind_id}">\n                                \n                                <div class="preorder-field preorder-field-button preorder_send">\n                                    <button type="submit" class="shop2-btn">${a.my.preorder_form_submitt||"Отправить"}</button>\n                                </div>\n                                \n                            </form>\n                            <div class="block-recaptcha"></div>\n                        </div>\n                        <div class="preorder-form-close"></div>\n                            `;a.alert(n,"close","preorder-alert")})),e(document).on("click",".preorder-form-close",(function(t){e("#shop2-alert-ok").click()})),e(document).on("submit",".block-recaptcha form",(function(o){o.preventDefault();var i,n,r=e(this).serializeArray();for(let e=0;e<r.length;e++)"_sitekey"==r[e].name&&(t.data._sitekey=r[e].value),"g-recaptcha-response"==r[e].name&&(t.data["g-recaptcha-response"]=r[e].value);i=t.data,n=o=>{if(t.jQbtn.get(0).setAttribute("disabled","disabled"),e(".preorder-form-wrap").html(`\n                    <h3 class="preorder-popup-success">\n                        ${a.my.preorder_form_success||"Спасибо!"}\t\n                    </h3>\n                `),t.jQbtn.closest("form").length){let e=t.jQbtn.closest("form").find(".favorite_btn");e.length&&!e.is(":hidden")&&e.trigger("click")}},e.ajax({url:"/my/s3/xapi/public/?method=shop2/addKindEmailNotification",method:"post",xhrFields:{withCredentials:!0},data:i,success:function(e){n(e)}})})),e(document).on("submit",".preorder-popup-body",(function(a){a.preventDefault();var o=e(this);t.data.email=this.email.value;/^[\w-\.]+@[\w-]+\.[a-z]{2,4}$/i.test(t.data.email)?e.get("/my/s3/xapi/public/?method=shop2/addKindEmailNotification",(function(e){const t=new RegExp(/<body[^>]*>(.*?)<\/body>/gi);let a=e.result.html.match(t);o.parent(".preorder-popup").find(".block-recaptcha").html(a)})):o.find(".preorder-email").hasClass("field-error")||o.find(".preorder-email").addClass("field-error").find(".preorder-email-input .preorder-field-value").before('<div class="error-message">Неверный формат адреса электронной почты</div>')}))},discounts:function(){e(document).on("click",".shop2-product-actions dt",(function(t){var a=e(this),o=a.next(),i=a.position().left;t.stopPropagation(),o.is(":hidden")&&(e(".shop2-product-actions dd").hide(),o.show(),o.css("left",i))})),e(document).on("click",".close-desc-action",(function(t){var a=e(this).closest("dd");t.stopPropagation(),a.hide()})),e(document).on("click",(function(){e(".shop2-product-actions dd").hide()}))},question:function(){var t=".price-old.question, .shop2-cart-total .question";e(document).on("mouseenter",t,(function(){var t=e(this),a=t.next().show(),o=t.position(),i=a.outerHeight(!0);a.css({top:o.top-i-5,left:o.left})})).on("mouseleave",t,(function(){e(this).next().hide()}))},tabs:function(){var t=e(".shop2-product-tabs li"),a=t.find("a"),o=e(".shop2-product-desc > div");a.on("click",(function(a){var i=e(this),n=i.attr("href");a.preventDefault(),t.removeClass("active-tab"),i.parent().addClass("active-tab"),o.removeClass("active-area"),e(n).addClass("active-area")}))},sort:function(){var t=e(".sorting");t.find(".sort-param").on("click",(function(t){var o=e(this).data("name");t.preventDefault(),a.filter.sort(o),a.filter.go()})),t.find(".sort-reset").on("click",(function(e){e.preventDefault(),a.filter.remove("s[sort_by]"),a.filter.go()}))},views:function(){e(".view-shop a").on("click",(function(t){var o=e(this).data("value");t.preventDefault(),a.filter.remove("view"),a.filter.add("view",o),a.filter.go()}))},toggle:function(){function t(t,a,o,i){e(document).on("click",a+" "+t,(function(t){var n=e(a);t.preventDefault(),n.hasClass(o)?(n.removeClass(o),eraseCookie(i)):(n.addClass(o),createCookie(i,1,7))}))}t(".block-title",".cart-preview","opened","cart_opened"),t(".block-title",".search-form","opened","search_opened"),t(".block-title",".login-form ","opened","login_opened")},search:function(){var t=e("#shop2_search_custom_fields"),o=e("#shop2_search_global_fields");a.on("afterGetFolderCustomFields",(function(e,a){t.html(e.data),o.find("input, select").prop("disabled",!0),o.hide()})),e("#s\\[folder_id\\]").on("change",(function(){var i=e(this).val();i?a.search.getParams(i):(t.html(""),o.find("input, select").prop("disabled",!1),o.show())})).trigger("change"),a.facets.enabled&&!a.my.lazy_search_activation&&a.facets.searchSetup()},cart:function(){var t,o=e(".shop2-cart-update"),i=e(".shop2-cart-table"),n=e("#shop2-cart").parents("form:first");function r(){o.show()}a.on("afterCartRemoveItem, afterCartUpdate",(function(){document.location.reload()})),["keypress","keyup","keydown"].forEach((function(e){if("on"+e in document)return t=e,!1})),i.find("input:text").on(t,(function(e){13==e.keyCode?a.cart.update(n):r()})),e(document).on("click","li.param-value:not(.shop2-color-ext-selected)",(function(){r()})),e(document).on("change","select.param-value",(function(){r()})),i.find(".amount-minus, .amount-plus").on("click",r),o.on("click",(function(e){return e.preventDefault(),a.cart.update(n),!1})),e(".cart-delete a").on("click",(function(t){var o=e(this),i=o.data("id");t.preventDefault(),a.cart.remove(i,o.data("path"))})),e("#shop2-deligate-calc").on("click",(function(t){var o={},i=e("#shop2-order-delivery"),n=i.find(".shop2-delivery--item__tab");e("#shop2-perfect-form").find("input, textearea, select").each((function(){e(this);"INPUT"===this.tagName&&"checkbox"===this.type?this.checked&&(o[this.name]="on"):o[this.name]=e(this).val()})),t.preventDefault(),n.removeClass("active-tab"),n.removeClass("point"),i.addClass("preloader"),e("#shop2-delivery-wait").show(),e("input#address").blur(),e("#shop2-deligate-calc").hide(),e.ajax({url:"/my/s3/xapi/public/?method=deligate/calc&param[get_vars][]",type:"post",dataType:"json",data:o,success:function(t){if(i.removeClass("preloader"),e("#shop2-delivery-wait").hide(),e("#shop2-order-delivery").html(t.result.html),e("#shop2-order-delivery").append('<div class="preloader"><div class="spinner"></div></div>'),e("#shop2-order-delivery").find(".delivery-items").each((function(){var t=e(this);""==e.trim(t.text())&&t.parents(".shop2-delivery--item__tab:first").addClass("disabled")})),t.result.error){a.alert(t.result.error);let o=a.my.on_shop2_btn?".shop2-btn":".g-button";e(".order_design_five").length&&(e(".order_design_five  ul li").length<=1&&e(".order_design_five  ul li").before(`<li>${t.result.error}</li>`),e(`.form-item ${o}`).addClass("shop2-disabled"),e(".order_design_five").removeClass("hide"))}else{var o=e.parseJSON(e("#dadata").val());o.geo_lat,o.geo_lon;let t=a.my.on_shop2_btn?".shop2-btn":".g-button";e(".order_design_five ").length&&(e(".order_design_five  ul li").length>1&&e(".order_design_five  ul li").first().remove(),e(`.form-item ${t}`).removeClass("shop2-disabled"),e(".order_design_five").addClass("hide")),a.queue.edost2(),e("#shop2-ems-calc, #shop2-edost-calc").on("click",(function(t){var o=e(this).data("attach-id"),i=e("select[name="+o+"\\[to\\]]"),n=e("input[name="+o+"\\[zip\\]]"),r=e("input[name="+o+"\\[order_value\\]]");0==i.length&&(i=e("#shop2-edost2-to")),t.preventDefault(),i=i.get(0)?i.val():"",n=n.get(0)?n.val():"",r=r.prop("checked")?"on":"",a.delivery.calc(o,"to="+i+"&zip="+n+"&order_value="+r,(function(t){!t.data&&t.errstr?(a.alert(t.errstr),e("#delivery-"+o+"-cost").html(0)):(e("#delivery-"+o+"-cost").html(t.data.cost),t.data.html&&(e("#delivery-"+o+"-html").html(t.data.html),a.queue.edost()))}))})),e("#shop2-deligate-calc").hide()}}})}))},coupon:function(){a.on("afterCartAddCoupon, afterCartRemoveCoupon",(function(){document.location.reload()})),e(".coupon-btn").on("click",(function(t){var o=e("#coupon").val();t.preventDefault(),o&&a.cart.addCoupon(o)})),e(".coupon-delete").on("click",(function(t){var o=e(this).data("code");t.preventDefault(),o&&a.cart.removeCoupon(o)}))},delivery:function(){e("#shop2-order-delivery").find(".delivery-items").each((function(){var t=e(this);""==e.trim(t.text())&&t.parents(".shop2-delivery--item__tab:first").addClass("disabled")})),e(document).on("change",".map-select select",(function(){var t=e(this),o=t.find("option:selected").index(),i=(t.find("option:selected").text(),t.val());if(0!=o)for(var n,r=a.delivery.ymapsMap.geoObjects.getIterator();n=r.getNext();){for(var s=0,c=n.getLength();s<c;s++){var l=n.get(s);l.properties.get("id")===i?(l.options.set("iconImageHref",a.delivery.ymapsIconsData.selected),l.balloon.isOpen()?l.balloon.close():l.balloon.open()):l.options.set("iconImageHref",a.delivery.ymapsIconsData.default)}return}else a.delivery.ymapsMap.balloon.close()})),e(".shop2-payment-options .option-type").each((function(){if(e(this).hasClass("option-payment-systems")&&e(this).hasClass("active-type")){var t=e(".shop2-payment-options .shop2-payment-btn"),a=(e(".shop2-payment-options .shop2-payment-btn").attr("data-continue-text"),e(".shop2-payment-options .shop2-payment-btn").attr("data-pay-text"));t.text(a)}})),e(document).on("click",".shop2-cart-order-payments .options-list .option-type:not(.active-type) .option-label.payments-label",(function(t){t.stopPropagation();var a=e(this);e(document).find(".shop2-cart-order-payments .option-type").removeClass("active-type"),a.parent().addClass("active-type")})),e(document).on("click",".option-label:not(.payments-label)",(function(t){var o=e(this),i=e(document).find(".option-label"),n=e(document).find(".option-type"),r=i.next();o.parent().index();"INPUT"!=t.target.nodeName&&a.delivery.deligate&&t.preventDefault(),a.delivery.ymapsMap&&(a.delivery.ymapsMap.destroy(),a.delivery.ymapsMap=null);{let t=a.my.on_shop2_btn?".shop2-btn":".g-button";o.hasClass("ymap")?e(`.form-item ${t}`).length&&(e(`.form-item ${t}`).addClass("shop2-disabled"),e(".order_design_five").removeClass("hide")):e(`.form-item ${t}.shop2-disabled`).length&&(e(`.form-item ${t}.shop2-disabled`).removeClass("shop2-disabled"),e(".order_design_five").addClass("hide"))}if(n.removeClass("active-type"),o.parent().addClass("active-type"),r.find("input, textarea, select").prop("disabled",!0),o.next().find("input, textarea, select").prop("disabled",!1),a.delivery.deligate&&o.find("input:first").prop("checked",!0),o.hasClass("ymap")&&a.delivery.YmapsInit(o.data("service-code")),e(".shop2-payment-options .shop2-btn").hasClass("shop2-payment-btn")){var s=e(".shop2-payment-options .shop2-payment-btn"),c=e(".shop2-payment-options .shop2-payment-btn").attr("data-continue-text"),l=e(".shop2-payment-options .shop2-payment-btn").attr("data-pay-text");o.parent().hasClass("option-payment-systems")?s.text(l):s.text(c)}e(".cart-wrap").validator("update"),e(".cart-wrap").validator("validate")})),e(document).on("click",".shop2-delivery--item__tab .tab-label",(function(){var t=e(document).find(".shop2-delivery--item__tab"),a=e(this).parents(".shop2-delivery--item__tab:first"),o=a.index();if(a.hasClass("disabled"))return!1;if(a.hasClass("active-tab"))a.removeClass("active-tab");else{t.removeClass("active-tab").eq(o).addClass("active-tab");var i=e(".active-tab .tab-label").offset().top-10;e("html, body").animate({scrollTop:i},800)}})),e(document).on("click",".option-label:not(.payments-label)",(function(){var t=e(this),a=t.data("attach_id"),o=t.parent().siblings(".option-type"),i=t.parents(".shop2-delivery--item__tab:first").siblings();e("#delivery_id_deligate").val(a),e("#deligate_points_fields .fields").empty(),e("#deligate_points_fields").hide(),i.find(".option-type input").prop("checked",!1),i.removeClass("point"),o.find("input").prop("checked",!1)})),e("#shop2-ems-calc, #shop2-edost-calc").on("click",(function(t){var o=e(this).data("attach-id"),i=e("select[name="+o+"\\[to\\]]"),n=e("input[name="+o+"\\[zip\\]]"),r=e("input[name="+o+"\\[order_value\\]]");0==i.length&&(i=e("#shop2-edost2-to")),t.preventDefault(),i=i.get(0)?i.val():"",n=n.get(0)?n.val():"",r=r.prop("checked")?"on":"",a.delivery.calc(o,"to="+i+"&zip="+n+"&order_value="+r,(function(t){!t.data&&t.errstr?(a.alert(t.errstr),e("#delivery-"+o+"-cost").html(0)):(e("#delivery-"+o+"-cost").html(t.data.cost),t.data.html&&(e("#delivery-"+o+"-html").html(t.data.html),a.queue.edost()))}))}))},edost:function(){function t(t){var a="[name="+t.replace(/([\[\]])/g,"\\$1")+"]";return e(a)}var o=e("#shop2-edost-calc").data("attach-id"),i=t(o+"[address]");function n(t){var a=e.trim(t.text()).replace(/\s*\n\s*/g,"\n").split("\n").splice(1).join("\n");i.val(a).prop("readonly",!0)}t(o+"[edost][office]").on("click",(function(){var t=e(this);n(t.closest(".shop2-edost-office")),t.prop("checked",!0)})),t(o+"[edost][tarif]").on("click",(function(){var t,o=e(this).closest(".shop2-edost-variant"),r=o.siblings(),s=o.find(".shop2-edost-office");r.find(".shop2-edost-office input, .shop2-edost-pickpointmap input").prop({disabled:!0,checked:!1});var c=o.find(".shop2-edost-office input, .shop2-edost-pickpointmap input").prop({disabled:!1}).filter(":radio");t=c.filter(":checked"),c.get(0)?t.get(0)?t.trigger("click"):c.eq(0).trigger("click"):1==s.length?n(s):i.prop("readonly")&&i.prop("readonly",!1).val(""),a.trigger("afterEdostSet")})).filter(":checked").trigger("click"),e(".shop2-edost-pickpointmap a").on("click",(function(){var t=e(this),a=t.children(),o=t.data("city");return t.closest(".shop2-edost-variant").find("> label input").trigger("click"),PickPoint.open((function(o){var n={};e.each(["name","address","id"],(function(e,t){n[t]=o[t]})),t.next().val(JSON.stringify(n)),a.html(": "+n.name),i.val(n.name+",\n"+n.address).prop("readonly",!0)}),{city:o,ids:null}),!1}))},edost2:function(){if(window.shop2EdostRegions){var t,a=e("#shop2-edost2-country"),o=a.html(),i=e("#shop2-edost2-region"),n=i.html(),r=e("#shop2-edost2-city"),s=r.html(),c=e("#shop2-edost2-to");a.length&&(t=e.grep(shop2EdostRegions,(function(e){return e.is_country})),a.html(o+u(t)),h(i),h(r),a.on("change",(function(){var a=e(this).val();i.length?(t=e.grep(shop2EdostRegions,(function(e){return e.is_region&&e.country==a})),i.html(n+u(t)),0==t.length?(h(i),h(r),c.val(a)):(m(i),c.val(""))):r.length?(t=e.grep(shop2EdostRegions,(function(e){return e.is_city&&e.country==a})),r.html(s+u(t)),0==t.length?(h(r),c.val(a)):(m(r),c.val(""))):c.val(a)}))),i.length&&(a.length||(t=e.grep(shop2EdostRegions,(function(e){return e.is_region})),i.html(n+u(t)),h(r)),i.on("change",(function(){var a=e(this).val();t=e.grep(shop2EdostRegions,(function(e){return e.is_city&&e.region==a})),r.html(s+u(t)),0==t.length?(h(r),c.val(a)):(m(r),c.val(a))}))),a.length||i.length||(t=e.grep(shop2EdostRegions,(function(e){return e.is_city})),r.html(n+u(t))),r.on("change",(function(){var t=e(this).val();"default"===t?i.length&&c.val(i.val()):t&&c.val(t)}));var l=a.data("value"),d=i.data("value"),p=r.data("value");l&&a.val(l),a.trigger("change"),d&&i.val(d),i.trigger("change"),p&&r.val(p),r.trigger("change")}function u(t){return e.map(t,(function(e){return'<option value="'+e.id+'">'+e.name+"</option>"})).join("")}function h(e){e.html("").closest(".option-item").addClass("hide")}function m(e){e.closest(".option-item").removeClass("hide")}},print:function(){e("#order-print").on("click",(function(){return s3.printMe("shop2-order",{stylesheet:a.options.printCSS}),!1}))},hs:function(){e(".shop2-compare-product-image a img, .shop2-compare-data a img, .shop2-product .product-image a img, .shop2-product .product-thumbnails li a img, .cart-product-image a img, .cart-product-param a img").closest("a").on("click",(function(){return hs.expand(this),!1})).addClass("highslide"),e(document).on("click",".shop2-edost-office-address a",(function(){return hs.htmlExpand(this,{objectType:"iframe",wrapperClassName:"draggable-header",outlineType:"rounded-white",width:900,height:600,align:"center"}),!1}))},vendors:function(){e(".shop2-vendor").eachRow((function(t){var a=t.getHeights();t.each((function(t){var o=e(this),i=a.max-a.values[t],n=o.find(".vendor-name"),r=n.height();n.css("min-height",r+i)}))}))},toggleFields:function(){var t=e(".shop2-filter-fields"),a="filter_opened",o=readCookie(a),i=e(".shop2-toggle-fields");i.on("click",(function(){var o=e(this),i=o.data("alt"),n=o.html();return t.hasClass("hide")?createCookie(a,1,7):eraseCookie(a),t.toggleClass("hide"),o.html(i),o.data("alt",n),!1})),o||i.trigger("click")},lazyLoad:function(){var t=e(document),o=e(window),i=!1,n=e(".product-list"),r=1e6;a.my.lazy_load_subpages&&n.get(0)&&t.scroll((function(){var n=e(".shop2-pagelist:last"),s=e(".product-list:last"),c=s.offset().top+s.height();if(void 0===a.page&&(a.page=1),t.scrollTop()+o.height()>=c&&!i&&a.page<r){i=!0;var l="/my/s3/xapi/public/?method=shop2/lazyLoad",d={param:{page_num:a.page,url:window.location.pathname}};window.location.search&&(l+="&"+window.location.search.substring(1)),n.length&&e(".custom-shop2-pagelist").length<1&&e.ajax({url:l,type:"GET",dataType:"json",data:d,success:function(e){s.after("<hr />"+e.result.data.html),a.page=parseInt(a.page)+1,a.productRefs=Object.assign(a.productRefs,e.result.data.product_refs),r=e.result.data.pages,n.hide(),a.queue.heights(),i=!1,a.trigger("afterProductsLazyLoaded")}})}}))},compare:function(){e(document).on("click",".product-compare input:checkbox",(function(){var t=e(this),o=t.attr("checked")?"del":"add";a.compare.action(o,t.val(),(function(o,i){"success"==i&&(o.errstr?(a.alert(o.errstr),t.prop("checked",!1)):function(t,a){e("input[type=checkbox][value="+t.val()+"]").closest(".product-compare").replaceWith(a.data),e(".product-compare-added a span").html("("+a.count+")"),a.panel&&e("#shop2-panel").replaceWith(a.panel)}(t,o))}))}))},compareTable:function(){e(".shop2-compare-table").each((function(){var t=e(this),o=t.find(".shop2-compare-switch a"),i=t.find(".shop2-compare-data");t.find(".shop2-compare-delete").on("click",(function(){var t=e(this).data().id;return a.compare.remove(t,(function(){document.location.reload()})),!1})),o.on("click",(function(){var t=e(this);return o.removeClass("shop2-compare-switch-active"),t.addClass("shop2-compare-switch-active"),0===t.index()?i.show():i.each((function(){var t=e(this);(function(e){var t=e.find("td"),a=t.eq(1).html(),o=!1,i=2,n=t.length;if(n<=2)return!1;for(;i<n;i+=1){if(a!=t.eq(i).html()){o=!0;break}a=t.eq(i).html()}return o})(t)?t.show():t.hide()})),!1})).eq(1).trigger("click")}))},favorite:function(){e(document).on("click",".favorite_btn",(function(){var t=e(this),o=t.parents("form").find('input[name="kind_id"]').val(),i=t.parents(".favorite_btn_wrapper").find(".favorite_btn_active");e.ajax({url:"/my/s3/xapi/public/?method=shop2/addFavoriteProduct&param[kind_id]="+o,type:"post",dataType:"json",data:o,success:function(o){var n=o.result.count;e(".favorite_btn_active a > span").text(n),e(".shop2_favorite_cart_link span").text(n),e(".favorite_panel").removeClass("not-null"),a.msg("Добавлено в <a href='%s'>избранное</a>".replace("%s",a.uri+"/favorites"),t),t.hide(),i.show()}})})),e(document).on("click",".favorite_btn_active .icon",(function(){var t=e(this).parents("form").find('input[name="kind_id"]').val();e('<div class="shop2-popup_favorite"><div class="popup_inner"><div class="text">Удалить товар из избранного?</div><div class="btns"><div class="shop2-btn delete_fovorite" data-kind_id="'+t+'">Удалить</div><div class="shop2-btn-close close_favorite">Закрыть</div></div></div></div>').appendTo("body")})),e(document).on("click",".delete_fovorite",(function(){var t=e(this).data("kind_id"),a=e("body").find('form input[value="'+t+'"]').closest("form"),o=a.find(".favorite_btn"),i=a.find(".favorite_btn_active");e.ajax({url:"/my/s3/xapi/public/?method=shop2/removeFavoriteProduct&param[kind_id]="+t,type:"post",dataType:"json",data:t,success:function(t){var a=t.result.count;e(".favorite_btn_active a > span").text(a),e(".shop2_favorite_cart_link span").text(a),0==a&&e(".favorite_panel").addClass("not-null"),i.hide(),o.show()}}),e(".shop2-popup_favorite").remove()})),e(document).on("click",".close_favorite",(function(){e(".shop2-popup_favorite").remove()})),e(document).on("click",".shop2-btn_popup_favorite",(function(t){e('<div class="shop2-popup_favorite"><div class="popup_inner"><div class="text">Удалить все товары из избранного?</div><div class="btns"><div class="shop2-btn clear_fovorite">Удалить</div><div class="shop2-btn-close close_favorite">Закрыть</div></div></div></div>').appendTo("body"),t.preventDefault()})),e(document).on("click",".clear_fovorite",(function(t){e.ajax({url:"/my/s3/xapi/public/?method=shop2/clearFavoriteProducts",type:"post",dataType:"json",success:function(e){}}),location.reload()}))},buyOneClick:function(){if(e(".buy-one-click-js").length){var t={status_modal:!1};if(e('[data-remodal-id="buy-in-one-click"]').length){(a=e('[data-remodal-id="buy-in-one-click"]').remodal()).str_block='[data-remodal-id="buy-in-one-click"]',a.str_btn=".buy-one-click-js",a.settings.hashTracking=!1,a.open_modal=function(t){e(this.str_block).find(".shop2-buy-one-click-block").html(t),this.open()},a.up_scroll=function(){this.$wrapper.scrollTop(0)}}else{var a={str_block:".buy-one-click-container",str_btn:".buy-one-click-js",open_modal:function(e){t.opening(`\n\t\t\t\t<div class="${this.str_block.replace(".","")}">\n\t\t\t\t\t<div class="preorder-form-close"></div>\n\t\t\t\t\t<div class="shop2-buy-one-click-block">${e}</div>\n\t\t\t\t</div>\n\t\t\t\t`)},up_scroll:function(){e(this.str_block).parent().parent().scrollTop(0)}};function s(){e("html").removeClass("oveflowHidden"),this.current_modal.removeClass("opened"),this.status_modal=!1}function c(){e("html").addClass("oveflowHidden"),this.current_modal.addClass("opened"),this.status_modal=!0}e(document).on("keyup.esc_keyup",(function(e){return!(27!=e.keyCode||!t.status_modal)&&(s.apply(t),!1)})),e(document).on("click",(function(a){a.stopPropagation();let o=e(a.target);(o.is(".buy-one-click-container .preorder-form-close")||o.is(".shop2-buy-one-click-popup"))&&s.apply(t)})),window.$popup=e('<div class="shop2-buy-one-click-popup">\n\t\t\t\t\t<div class="shop2-buy-one-click-popup__inner">\n\t\t\t\t\t</div>\n\t\t\t\t</div>'),e("body").append($popup),t.current_modal=$popup,t.opening=function(e){this.current_modal.find(".shop2-buy-one-click-popup__inner").html(e),c.apply(this)}}e(document).on("click",a.str_block+" .order_one_click_amount_js",(function(t){var a=e(t.target);(a.hasClass("amount-plus")||a.hasClass("amount-minus"))&&n(a)})),e(document).on("change",".order_one_click_amount_js input",(function(){var t=e(this);setTimeout((function(){n(t)}),100)})),e(document).on("click",a.str_btn,(function(n){n.preventDefault(),t._this=this,t.kind_id=+e(t._this).data("product-kind_id"),t.form=e(t._this).closest("form"),r({requestType:"get",callback:function(n){let r=e.trim(n.result.html).replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");a.open_modal(r),i(),e(".order_one_click_amount_js input").val(t.form[0].amount.value).trigger("change"),o()}})})),e(document).on("submit",a.str_block+" form",(function(t){t.preventDefault();var o=e(this).serializeArray(),i=e(a.str_block+" .order_field_email"),n=!0;i.each((function(){if(t=e(this).val(),!/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(String(t).toLowerCase()))return e(this).closest(".tpl-field").addClass("field-error").find(".error-message").removeClass("hide"),n=!1;var t})),n&&r({requestType:"post",serializeData:o})}))}function o(){"undefined"!=typeof shop2_gr&&void 0!==shop2_gr.methods.amountInit&&shop2_gr.methods.amountInit()}function i(){"undefined"!=typeof grFormDatePicker?grFormDatePicker.init():e(".datepickerInit").each((function(t,a){e(this).datepicker({minDate:0,changeMonth:!1,numberOfMonths:1})}))}function n(e){var t=e.closest(".shop2-buy-one-click__product-right"),a=+String(t.find(".shop2-buy-one-click__total").data("price")).replace(/\u00A0/g,""),o=(t.find(".shop2-product-amount input").data("min"),a*+t.find(".shop2-product-amount input").val());t.find(".shop2-buy-one-click__total .price-current strong").text(Math.floor(o))}function r(n){let r=n.requestType||"post";if("get"==r){let o="/my/s3/xapi/public/?method=shop2/buyOneClick&param[kind_id]="+t.kind_id,i=e(a.str_btn).data("images-size"),s=e(a.str_btn).data("images-view");s&&(o+="&gr_images_view="+s),i&&(o+="&gr_images_size="+i),e.ajax({url:o,type:r,cache:!1,dataType:"json"}).done((function(e){n.callback&&n.callback(e)}))}else{let t="/my/s3/xapi/public/?method=shop2/buyOneClick",s=n.serializeData,c=e(a.str_btn).data("images-size"),l=e(a.str_btn).data("images-view");l&&(t+="&gr_images_view="+l),c&&(t+="&gr_images_size="+c),e.ajax({url:t,data:s,type:r,cache:!1,dataType:"json"}).done((function(t){if(t.result.error)return e(a.str_block+" .shop2-warning").remove(),e(a.str_block+" .shop2-buy-one-click__result").prepend('<div class="shop2-warning">'+t.result.error+"</div>"),a.up_scroll(),!1;let r=e.trim(t.result.html).replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");e(a.str_block).find(".shop2-buy-one-click-block").html(r),i(),e(".order_one_click_amount_js input").trigger("change"),o(),n.callback&&n.callback(t)}))}}},alert:function(){var t,o,i,n,r,s=['<div id="shop2-alert">','<div id="shop2-alert-body"></div>','<a href="#" id="shop2-alert-ok" class="shop2-btn"></a>',"</div>",'<div id="shop2-alert-overlay"></div>'].join("\n");function c(){return o.hide(),t.hide(),t.removeAttr("class"),r="",a.trigger("alertHide",t),!1}e(document.body).append(s),t=e("#shop2-alert"),o=e("#shop2-alert-overlay"),i=e("#shop2-alert-body"),n=e("#shop2-alert-ok"),o.on("click",c),n.on("click",c),a.alert=function(e,s,c){n.html(s||"Ok"),i.html(e),r=c||"shop2-alert--warning",o.show(),t.attr("class",r),t.show().s3center(),a.trigger("alertShow",t)},a.alert.hide=c},tooltip:function(){e(".shop2-tooltip").s3tooltip({cls:"shop2-color-ext-tooltip",dir:"top",data:function(){return e(this).data("tooltip")}})},colorTooltip:function(){e(".shop2-color-ext-list li").s3tooltip({cls:"shop2-color-ext-tooltip",dir:"top",data:function(){return e(this).children("div").html()}}),e(".shop2-color-ext-multi").s3tooltip({cls:"shop2-color-ext-tooltip shop2_multi_tooltip",dir:"top",data:function(){var e=this.getElementsByTagName("ul");if(e.length)return e[0].outerHTML}})},colorPopup:function(){var t=e('<div id="shop2-color-ext-popup"></div>'),o=e('<div id="shop2-color-ext-close"></div>'),i=e('<ul id="shop2-color-ext-list" class="shop2-color-ext-list"></ul>'),n=null;t.append(o),t.append(i),e(document.body).append(t),e.on(".shop2-color-ext-caption",{click:function(){var a=e(this),o=a.closest(".shop2-color-ext-popup").find(".shop2-color-ext-list"),r=a.offset();return n=o.children("li"),i.html(o.html()),t.css(r).show(),!1}}),e(document).on("click",".shop2-color-ext-list li",(function(){var t=e(this),o=t.data(),i=t.parent().find("input.additional-cart-params"),r=t.is(".shop2-color-ext-selected");if(void 0!==o.kinds||i.length)t.addClass("shop2-color-ext-selected").siblings().removeClass("shop2-color-ext-selected"),i.length?i.val(o.value):r||a.product._reload(this);else{var s=t.index();!!t.closest("#shop2-color-ext-popup").length&&(t.toggleClass("shop2-color-ext-selected"),n.eq(s).toggleClass("shop2-color-ext-selected"),a.filter.toggle(o.name,o.value),a.filter.count())}})),e(document).on("click",(function(a){e(a.target).closest("#shop2-color-ext-popup").get(0)&&a.target!=o.get(0)||t.hide()}))},colorSelect:function(){var t=e('<div id="shop2-color-ext-select"><ins></ins></div>'),o=null,i=null;function n(){if(t.is(":visible"))return t.hide(),!0}e(document.body).append(t),e(document).on("click",n),e.on(".shop2-color-ext-select",{click:function(){if(!n()){var a=e(this),r=a.find(".shop2-color-ext-options"),s=a.offset(),c='<div class="baron-wrapper"> <div class="baron-scroller">   <div class="baron-container">     <div class="shop2-color-ext-options">'+r.html()+'     </div>   </div>   <div class="baron-scroller-bar"></div> </div></div>';o=r.children("li"),i=a.find("input"),t.html(c),t.show();var l,d=a.width(),p=t.data("width")||(l=t.width(),t.data("width",l),l);return d>p?t.css("width",d):t.css("width",p),baron(t,{scroller:".baron-scroller",container:".baron-container",bar:".baron-scroller-bar"}),t.css(s),!1}}}),e.on("#shop2-color-ext-select li:not(.shop2-color-ext-selected)",{click:function(){var t=e(this),n=t.index(),r=t.data();t.addClass("shop2-color-ext-selected").siblings().removeClass("shop2-color-ext-selected"),o.removeClass("shop2-color-ext-selected"),o.eq(n).addClass("shop2-color-ext-selected"),r.kinds?a.product._reload(o.get(n)):(i.val(r.value),e(i).closest(".search-form").length||a.cf_margin_price_enabled&&a.margin_price.price_change(i,"form"),t.hasClass("js-calc-custom-fields")&&a.product._reload(o.get(n)))}}),e.on(".js-calc-custom-fields",{change:function(){var t=e(this);a.product._reload(t.find(":selected").parent())}}),e.on(".shop2-color-ext-list .js-calc-custom-fields:not(select)",{click:function(){var t=e(this);a.product._reload(t.parent())}})},coordinates:function(){e(document).on("click",".shop2-map-link",(function(t){t.preventDefault();var o=e(this),i=o.data(),n=i.map;n.title||(n.title=o.text()),a.maps.alert(i.mapType,n)}))},fixDoubleOrders:function(){var t=e(".shop2-order-form, .shop2-order-in-one-page-form"),a=t.find("[type=submit]");t.on("submit",(function(){a.prop("disabled",!0),setTimeout((function(){a.prop("disabled",!1)}),1e3)}))},paymentMethods:function(){var t=e(".shop2-payment-type input"),a=e(".shop2-payment-methods input");t.on("change",(function(){var t=e(this).closest(".shop2-payment-type").next(".shop2-payment-methods").find("input:first");a.prop("checked",!1),t.prop("checked",!0)})),a.on("change",(function(){var a=e(this).closest(".shop2-payment-methods").prev(".shop2-payment-type").find("input:first");t.prop("checked",!1),a.prop("checked",!0)}))},auth:function(){e(document).on("click",".js-shop2-cart-auth__expand",(function(t){t.preventDefault(),e(".js-shop2-cart-auth__form").toggle()}))},orderGetPayments:function(t,o){let i=t||!1,n=o||!1;if(6==a.shop2_cart_order_payments){var r=e(".shop2-order-options.shop2-delivery"),s=r.find(".option-type"),c=r.find('.option-label [name="delivery_id"]'),l=e(".shop2-cart-order-payments");function p(t,o){var i=this,n=i.value,r=i.property_attach||0,s=i.tarif||0,c=i.delivery_type||0;if(n){let t={attach_id:n,html:!0,mode:"one-page"};if(r?t.attach=r:s&&(t.deligate={},t.deligate.tarif=s),c){let e={delivery_type:c,deligate:{tarif:i.tarif,pos:i.pos,code:i.code,insurance_type:i.insurance_type,tariff_id:i.tariff_id}};t.attach=e}e.ajax({method:"GET",url:"/my/s3/xapi/public/?method=shop2/getPayments",data:{param:t},success:function(e){void 0!==e.result&&void 0!==e.result.html?(l.html(e.result.html),void 0!==o&&o()):void 0!==e.error&&e.error.message&&l.html(e.error.message),a.trigger("afterGetDeliveryPayments")}})}}if(!i&&(c.on("click",p),e("#shop2-order-delivery .tab-label").length&&(e(document).on("click","#shop2-order-delivery .option-type:not(.active-type)",(function(t){let a={},o=e(this),i=o.find(".option-label"),n=i.find("input")[0];if(a.value=i.data("attach_id"),void 0!==o.attr("data-option-for-paymethod")){let e=o.attr("data-option-for-paymethod"),t=JSON.parse(e);a.delivery_type=t.delivery_type,a.value=t.attach_id,a.tarif=t.tariff_hash,a.pos=t.pos,a.code=t.code,a.insurance_type=t.insurance_type,a.tariff_id=t.tariff_id}else n.name.match("tarif")&&(a.tarif=n.value);p.call(a,"")})),e(".shop2-warning").hasClass("hide")))){let u=e("#shop2-order-delivery .option-type").filter(".active-type");u.trigger("click"),u.closest(".shop2-delivery--item__tab").addClass("active-tab")}if(l.length&&c.length&&!localStorage.getItem("delivery_item_active")){var d=s.filter(".active-type").find('.option-label [name="delivery_id"]');p.call(d,"",(()=>{let t=l.attr("data-payment_id")||!1;if(t){var a=l.find('.option-label [name="payment_id"]');a.first().removeAttr("checked");var o=a.filter((function(a,o){return e(o).val()==t||e(o).val()=="-"+t}));o.attr("checked","checked"),o.closest(".option-type").addClass("active-type").siblings().removeClass("active-type")}}))}i&&p.call(n)}}},a.cart.applyBonusPoint=function(t,o){return a.trigger("beforeCartApplyBonus"),e.getJSON("/my/s3/xapi/public/?method=cart/applyBonusPoints",{param:{hash:a.hash.cart,bonus_points:t}},(function(e,t){a.fire("afterCartApplyBonusPoints",o,e,t),a.trigger("afterCartApplyBonusPoints",e,t)})),!1},a.cart.removeBonusPoint=function(t){a.trigger("beforeCartRemoveCartBonusPoints"),e.getJSON("/my/s3/xapi/public/?method=cart/RemoveBonusPoints",{param:{hash:a.hash.cart}},(function(e,o){a.fire("afterCartRemoveCartBonusPoints",t,e,o),a.trigger("afterCartRemoveCartBonusPoints",e,o)}))},a.margin_price={price_change:function(t,o){if("cart"==a.mode)return r=e("#shop2-cart"),void a.cart.update(r);var i,n=e(t).closest(o),r=n.get(0),s=(r.kind_id.value,n.find(".additional-cart-params")),c=s.length,l={kind_id:r.kind_id.value,params:{}};if(c)for(var d=0;d<c;d+=1)(i=s[d]).value&&(l.params[i.name]=i.value);e.ajax({url:"/my/s3/xapi/public/?method=shop2/getPrice",type:"get",data:{param:l},dataType:"json",success:function(e){n.find(".price-current").replaceWith(e.result.data.html.price),n.find(".price-old ").replaceWith(e.result.data.html.price_old)}})},select_change:function(){a.cf_margin_price_enabled&&(e(document).on("click",".shop2-color-ext-list li",(function(){var t=e(this);setTimeout((function(){a.margin_price.price_change(t,"form")}),10)})),e("select.additional-cart-params").length&&e.on("select.additional-cart-params",{change:function(t){a.margin_price.price_change(e(t.target),"form")}}))}},a.queue.margin_price=function(){if("cart"==a.mode&&!e("#delivery_id_deligate").length){if(localStorage.getItem("delivery_item_active")){let t=e(".shop2-order-in-one-page-form .shop2-delivery .options-list .option-type").eq(+localStorage.getItem("delivery_item_active")).find(".option-label");t.trigger("click").addClass("active-type"),a.queue.orderGetPayments(!0,t.find('[name="delivery_id"]')[0])}else 6==a.shop2_cart_order_payments&&e(".shop2-order-in-one-page-form .shop2-delivery > .options-list > .option-type.active-type > .option-label input").trigger("click");e(".shop2-order-in-one-page-form .shop2-delivery .options-list .option-type .option-label").on("click",(function(){localStorage.setItem("delivery_item_active",e(".shop2-order-in-one-page-form .shop2-delivery .options-list .active-type").index())}))}a.margin_price.select_change()},a.queue.bonus=function(){a.on("afterCartApplyBonusPoints, afterCartRemoveCartBonusPoints",(function(){document.location.reload()})),e(".bonus-apply").on("click",(function(t){var o=e("#bonus-points"),i=Number(o.val()),n=Number(e(".bonus-amount").html());switch(!0){case""==i||i>n:t.preventDefault();break;case n>=i:a.cart.applyBonusPoint(i)}})),e(".bonus-delete").on("click",(function(e){a.cart.removeBonusPoint()})),e.fn.inputFilter=function(e){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",(function(){e(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")&&(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd))}))},e("#bonus-points").inputFilter((function(e){return/^\d*$/.test(e)}))};var n=a.maps={};n.alert=function(e,t){a.alert('<div id="shop2-alert-map"></div>',"Закрыть","shop2-alert--map"),n[e].ready((function(){n[e].draw("shop2-alert-map",t)}))},n.getCenter=function(t){e.each(t,(function(){this.x,this.y}))},n.yandex={ymaps:window.ymaps,_loading:e.Deferred(),_loading_init:!1,_loading_callback:function(e){this.ymaps=e,this._loading.resolve(e)},ready:function(t){this._loading.done(t),this.ymaps?this._loading.resolve(this.ymaps):this._loading_init||(""!=a.maps_yandex_key?e("head").append('<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&onload=shop2.maps.yandex._loading_callback&apikey='+a.maps_yandex_key+'" type="text/javascript">'):e("head").append('<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&onload=shop2.maps.yandex._loading_callback" type="text/javascript">'),this._loading_init=!0)},draw:function(a,o){(o=e.extend({},o)).title=e.s3escape(o.title),o.text=e.s3escape(o.text);var i=new this.ymaps.Map(a,{zoom:o.z,center:[o.x,o.y],behaviors:["drag","rightMouseButtonMagnifier","scrollZoom"]}),n=this.ymaps.templateLayoutFactory.createClass('<div class="shop2-map-baloon-content"><h3>$[properties.title]</h3>$[properties.text]</div>'),r=new t.ymaps.Placemark([o.x,o.y],o,{balloonContentLayout:n});i.geoObjects.add(r)}},n.google={gmaps:!(!window.google||!window.google.maps)&&window.google.maps,_loading:e.Deferred(),_loading_init:!1,_loading_callback:function(){try{this.gmaps=window.google.maps,this._loading.resolve(this.gmaps)}catch(e){console.log(e)}},ready:function(t){this._loading.done(t),this.gmaps?this._loading.resolve(this.gmaps):this._loading_init||(e("head").append('<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=shop2.maps.google._loading_callback&key='+a.maps_google_key+'" type="text/javascript">'),this._loading_init=!0)},draw:function(t,a){var o=new this.gmaps.Map(document.getElementById(t),{zoom:Number(a.z),center:new google.maps.LatLng(a.x,a.y)}),i=new google.maps.Marker({position:new google.maps.LatLng(a.x,a.y),map:o,title:a.title}),n=new google.maps.InfoWindow({content:'<div class="shop2-map-baloon-content"><h3>'+e.s3escape(a.title)+"</h3>"+e.s3escape(a.text)+"</div>"});this.gmaps.event.addListener(i,"click",(function(){n.open(o,i)}))}},e(window).on("load",(function(){a.queue.heights(),a.product.productDatePicker()})),t.shop2=a,e((function(){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/i.test(navigator.userAgent)?"touchend.respons":"click.respons";e(".personal-html-btn, .close-btn").on(t,(function(t){t.preventDefault(),e(".personal-html-content").toggleClass("active")})),e(document).on("click",".btn_payment_rest",(function(){e(".shop2-order-options-wrapper").slideToggle()})),e(document).on(t,(function(t){e(t.target).closest(".personal-html-content-in, .personal-html-btn").length||e(".personal-html-content").removeClass("active")})),e(this).keydown((function(t){27==t.which&&e(".personal-html-content").removeClass("active")})),e(document).on("click","#shop2-color-ext-select li",(function(){a.facets.enabled&&setTimeout((function(){var t="/my/s3/api/shop2/?cmd=getSearchMatches&hash="+a.apiHash.getSearchMatches+"&ver_id="+a.verId+"&"+e(a.facets.search.wrapper).serialize();a.facets.getDataSearch(t)}),100)})),e(".cart-wrap").validator(),e(document.body).on("change",".shop2-block.search-form #shop2_search_custom_fields select, .shop2-block.search-form #shop2_search_custom_fields input",(function(){a.facets.enabled&&setTimeout((function(){var t="/my/s3/api/shop2/?cmd=getSearchMatches&hash="+a.apiHash.getSearchMatches+"&ver_id="+a.verId+"&"+e(a.facets.search.wrapper).serialize();a.facets.getDataSearch(t)}),100)}))}))}(jQuery,window);